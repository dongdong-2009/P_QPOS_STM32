; generated by Component: ARM Compiler 5.04 update 1 (build 49) Tool: ArmCC [5040049]
; commandline ArmCC [--list --split_sections --debug -c --asm --interleave -o.\stm3210e-eval\usb_scsi.o --asm_dir=.\STM3210E-EVAL\ --list_dir=.\STM3210E-EVAL\ --depend=.\stm3210e-eval\usb_scsi.d --cpu=Cortex-M3 --apcs=interwork -O0 -I..\inc -I..\..\..\Libraries\CMSIS\Device\ST\STM32F10x\Include -I..\..\..\Libraries\STM32_USB-FS-Device_Driver\inc -I..\..\..\Libraries\STM32F10x_StdPeriph_Driver\inc -I..\..\..\Utilities\STM32_EVAL -I..\..\..\Utilities\STM32_EVAL\Common -I..\..\..\Utilities\STM32_EVAL\STM3210E_EVAL -IC:\Keil_v5\ARM\RV31\INC -IC:\Keil_v5\ARM\PACK\ARM\CMSIS\3.20.4\CMSIS\Include -IC:\Keil_v5\ARM\Inc\ST\STM32F10x -D__MICROLIB -DUSE_STDPERIPH_DRIVER -DSTM32F10X_HD -DUSE_STM3210E_EVAL --omf_browse=.\stm3210e-eval\usb_scsi.crf ..\src\usb_scsi.c]
                          THUMB

                          AREA ||i.SCSI_Address_Management||, CODE, READONLY, ALIGN=2

                  SCSI_Address_Management PROC
;;;594    *******************************************************************************/
;;;595    bool SCSI_Address_Management(uint8_t lun , uint8_t Cmd , uint32_t LBA , uint32_t BlockNbr)
000000  e92d41f0          PUSH     {r4-r8,lr}
;;;596    {
000004  4604              MOV      r4,r0
000006  460d              MOV      r5,r1
000008  4617              MOV      r7,r2
00000a  461e              MOV      r6,r3
;;;597      if ((LBA + BlockNbr) > Mass_Block_Count[lun] )
00000c  19b8              ADDS     r0,r7,r6
00000e  491c              LDR      r1,|L1.128|
000010  f8511024          LDR      r1,[r1,r4,LSL #2]
000014  4288              CMP      r0,r1
000016  d913              BLS      |L1.64|
;;;598      {
;;;599        if (Cmd == SCSI_WRITE10)
000018  2d2a              CMP      r5,#0x2a
00001a  d102              BNE      |L1.34|
;;;600        {
;;;601          Bot_Abort(BOTH_DIR);
00001c  2002              MOVS     r0,#2
00001e  f7fffffe          BL       Bot_Abort
                  |L1.34|
;;;602        }
;;;603        Bot_Abort(DIR_IN);
000022  2000              MOVS     r0,#0
000024  f7fffffe          BL       Bot_Abort
;;;604        Set_Scsi_Sense_Data(lun, ILLEGAL_REQUEST, ADDRESS_OUT_OF_RANGE);
000028  2221              MOVS     r2,#0x21
00002a  2105              MOVS     r1,#5
00002c  4620              MOV      r0,r4
00002e  f7fffffe          BL       Set_Scsi_Sense_Data
;;;605        Set_CSW (CSW_CMD_FAILED, SEND_CSW_DISABLE);
000032  2100              MOVS     r1,#0
000034  2001              MOVS     r0,#1
000036  f7fffffe          BL       Set_CSW
;;;606        return (FALSE);
00003a  2000              MOVS     r0,#0
                  |L1.60|
;;;607      }
;;;608    
;;;609      if (CBW.dDataLength != BlockNbr * Mass_Block_Size[lun])
;;;610      {
;;;611        if (Cmd == SCSI_WRITE10)
;;;612        {
;;;613          Bot_Abort(BOTH_DIR);
;;;614        }
;;;615        else
;;;616        {
;;;617          Bot_Abort(DIR_IN);
;;;618        }
;;;619        Set_Scsi_Sense_Data(CBW.bLUN, ILLEGAL_REQUEST, INVALID_FIELED_IN_COMMAND);
;;;620        Set_CSW (CSW_CMD_FAILED, SEND_CSW_DISABLE);
;;;621        return (FALSE);
;;;622      }
;;;623      return (TRUE);
;;;624    }
00003c  e8bd81f0          POP      {r4-r8,pc}
                  |L1.64|
000040  4810              LDR      r0,|L1.132|
000042  6881              LDR      r1,[r0,#8]            ;609  ; CBW
000044  4810              LDR      r0,|L1.136|
000046  f8500024          LDR      r0,[r0,r4,LSL #2]     ;609
00004a  4370              MULS     r0,r6,r0              ;609
00004c  4281              CMP      r1,r0                 ;609
00004e  d014              BEQ      |L1.122|
000050  2d2a              CMP      r5,#0x2a              ;611
000052  d103              BNE      |L1.92|
000054  2002              MOVS     r0,#2                 ;613
000056  f7fffffe          BL       Bot_Abort
00005a  e002              B        |L1.98|
                  |L1.92|
00005c  2000              MOVS     r0,#0                 ;617
00005e  f7fffffe          BL       Bot_Abort
                  |L1.98|
000062  4908              LDR      r1,|L1.132|
000064  7b48              LDRB     r0,[r1,#0xd]          ;619  ; CBW
000066  2224              MOVS     r2,#0x24              ;619
000068  2105              MOVS     r1,#5                 ;619
00006a  f7fffffe          BL       Set_Scsi_Sense_Data
00006e  2100              MOVS     r1,#0                 ;620
000070  2001              MOVS     r0,#1                 ;620
000072  f7fffffe          BL       Set_CSW
000076  2000              MOVS     r0,#0                 ;621
000078  e7e0              B        |L1.60|
                  |L1.122|
00007a  2001              MOVS     r0,#1                 ;623
00007c  e7de              B        |L1.60|
;;;625    /************************ (C) COPYRIGHT STMicroelectronics *****END OF FILE****/
                          ENDP

00007e  0000              DCW      0x0000
                  |L1.128|
                          DCD      Mass_Block_Count
                  |L1.132|
                          DCD      ||CBW||
                  |L1.136|
                          DCD      Mass_Block_Size

                          AREA ||i.SCSI_Format_Cmd||, CODE, READONLY, ALIGN=2

                  SCSI_Format_Cmd PROC
;;;356    *******************************************************************************/
;;;357    void SCSI_Format_Cmd(uint8_t lun)
000000  b510              PUSH     {r4,lr}
;;;358    {
000002  4604              MOV      r4,r0
;;;359      if (MAL_GetStatus(lun))
000004  4620              MOV      r0,r4
000006  f7fffffe          BL       MAL_GetStatus
00000a  b168              CBZ      r0,|L2.40|
;;;360      {
;;;361        Set_Scsi_Sense_Data(CBW.bLUN, NOT_READY, MEDIUM_NOT_PRESENT);
00000c  4907              LDR      r1,|L2.44|
00000e  7b48              LDRB     r0,[r1,#0xd]  ; CBW
000010  223a              MOVS     r2,#0x3a
000012  2102              MOVS     r1,#2
000014  f7fffffe          BL       Set_Scsi_Sense_Data
;;;362        Set_CSW (CSW_CMD_FAILED, SEND_CSW_ENABLE);
000018  2101              MOVS     r1,#1
00001a  4608              MOV      r0,r1
00001c  f7fffffe          BL       Set_CSW
;;;363        Bot_Abort(DIR_IN);
000020  2000              MOVS     r0,#0
000022  f7fffffe          BL       Bot_Abort
                  |L2.38|
;;;364        return;
;;;365      }
;;;366    }
000026  bd10              POP      {r4,pc}
                  |L2.40|
000028  bf00              NOP      
00002a  e7fc              B        |L2.38|
;;;367    
                          ENDP

                  |L2.44|
                          DCD      ||CBW||

                          AREA ||i.SCSI_Inquiry_Cmd||, CODE, READONLY, ALIGN=2

                  SCSI_Inquiry_Cmd PROC
;;;64     *******************************************************************************/
;;;65     void SCSI_Inquiry_Cmd(uint8_t lun)
000000  b570              PUSH     {r4-r6,lr}
;;;66     {
000002  4606              MOV      r6,r0
;;;67       uint8_t* Inquiry_Data;
;;;68       uint16_t Inquiry_Data_Length;
;;;69     
;;;70       if (CBW.CB[1] & 0x01)/*Evpd is set*/
000004  480b              LDR      r0,|L3.52|
000006  7c00              LDRB     r0,[r0,#0x10]
000008  f0000001          AND      r0,r0,#1
00000c  b110              CBZ      r0,|L3.20|
;;;71       {
;;;72         Inquiry_Data = Page00_Inquiry_Data;
00000e  4d0a              LDR      r5,|L3.56|
;;;73         Inquiry_Data_Length = 5;
000010  2405              MOVS     r4,#5
000012  e009              B        |L3.40|
                  |L3.20|
;;;74       }
;;;75       else
;;;76       {
;;;77         if ( lun == 0)
000014  b906              CBNZ     r6,|L3.24|
;;;78         {
;;;79           Inquiry_Data = Standard_Inquiry_Data;
000016  4d09              LDR      r5,|L3.60|
                  |L3.24|
;;;80         }
;;;81        
;;;82         if (CBW.CB[4] <= STANDARD_INQUIRY_DATA_LEN)
000018  4806              LDR      r0,|L3.52|
00001a  7cc0              LDRB     r0,[r0,#0x13]
00001c  2824              CMP      r0,#0x24
00001e  dc02              BGT      |L3.38|
;;;83           Inquiry_Data_Length = CBW.CB[4];
000020  4804              LDR      r0,|L3.52|
000022  7cc4              LDRB     r4,[r0,#0x13]
000024  e000              B        |L3.40|
                  |L3.38|
;;;84         else
;;;85           Inquiry_Data_Length = STANDARD_INQUIRY_DATA_LEN;
000026  2424              MOVS     r4,#0x24
                  |L3.40|
;;;86       }
;;;87       Transfer_Data_Request(Inquiry_Data, Inquiry_Data_Length);
000028  4621              MOV      r1,r4
00002a  4628              MOV      r0,r5
00002c  f7fffffe          BL       Transfer_Data_Request
;;;88     }
000030  bd70              POP      {r4-r6,pc}
;;;89     
                          ENDP

000032  0000              DCW      0x0000
                  |L3.52|
                          DCD      ||CBW||
                  |L3.56|
                          DCD      Page00_Inquiry_Data
                  |L3.60|
                          DCD      Standard_Inquiry_Data

                          AREA ||i.SCSI_Invalid_Cmd||, CODE, READONLY, ALIGN=2

                  SCSI_Invalid_Cmd PROC
;;;566    *******************************************************************************/
;;;567    void SCSI_Invalid_Cmd(uint8_t lun)
000000  b510              PUSH     {r4,lr}
;;;568    {
000002  4604              MOV      r4,r0
;;;569      if (CBW.dDataLength == 0)
000004  480e              LDR      r0,|L4.64|
000006  6880              LDR      r0,[r0,#8]  ; CBW
000008  b918              CBNZ     r0,|L4.18|
;;;570      {
;;;571        Bot_Abort(DIR_IN);
00000a  2000              MOVS     r0,#0
00000c  f7fffffe          BL       Bot_Abort
000010  e00b              B        |L4.42|
                  |L4.18|
;;;572      }
;;;573      else
;;;574      {
;;;575        if ((CBW.bmFlags & 0x80) != 0)
000012  480b              LDR      r0,|L4.64|
000014  7b00              LDRB     r0,[r0,#0xc]  ; CBW
000016  f0000080          AND      r0,r0,#0x80
00001a  b118              CBZ      r0,|L4.36|
;;;576        {
;;;577          Bot_Abort(DIR_IN);
00001c  2000              MOVS     r0,#0
00001e  f7fffffe          BL       Bot_Abort
000022  e002              B        |L4.42|
                  |L4.36|
;;;578        }
;;;579        else
;;;580        {
;;;581          Bot_Abort(BOTH_DIR);
000024  2002              MOVS     r0,#2
000026  f7fffffe          BL       Bot_Abort
                  |L4.42|
;;;582        }
;;;583      }
;;;584      Set_Scsi_Sense_Data(CBW.bLUN, ILLEGAL_REQUEST, INVALID_COMMAND);
00002a  4905              LDR      r1,|L4.64|
00002c  7b48              LDRB     r0,[r1,#0xd]  ; CBW
00002e  2220              MOVS     r2,#0x20
000030  2105              MOVS     r1,#5
000032  f7fffffe          BL       Set_Scsi_Sense_Data
;;;585      Set_CSW (CSW_CMD_FAILED, SEND_CSW_DISABLE);
000036  2100              MOVS     r1,#0
000038  2001              MOVS     r0,#1
00003a  f7fffffe          BL       Set_CSW
;;;586    }
00003e  bd10              POP      {r4,pc}
;;;587    
                          ENDP

                  |L4.64|
                          DCD      ||CBW||

                          AREA ||i.SCSI_ModeSense10_Cmd||, CODE, READONLY, ALIGN=2

                  SCSI_ModeSense10_Cmd PROC
;;;164    *******************************************************************************/
;;;165    void SCSI_ModeSense10_Cmd (uint8_t lun)
000000  b510              PUSH     {r4,lr}
;;;166    {
000002  4604              MOV      r4,r0
;;;167      Transfer_Data_Request(Mode_Sense10_data, MODE_SENSE10_DATA_LEN);
000004  2108              MOVS     r1,#8
000006  4802              LDR      r0,|L5.16|
000008  f7fffffe          BL       Transfer_Data_Request
;;;168    }
00000c  bd10              POP      {r4,pc}
;;;169    
                          ENDP

00000e  0000              DCW      0x0000
                  |L5.16|
                          DCD      Mode_Sense10_data

                          AREA ||i.SCSI_ModeSense6_Cmd||, CODE, READONLY, ALIGN=2

                  SCSI_ModeSense6_Cmd PROC
;;;152    *******************************************************************************/
;;;153    void SCSI_ModeSense6_Cmd (uint8_t lun)
000000  b510              PUSH     {r4,lr}
;;;154    {
000002  4604              MOV      r4,r0
;;;155      Transfer_Data_Request(Mode_Sense6_data, MODE_SENSE6_DATA_LEN);
000004  2104              MOVS     r1,#4
000006  4802              LDR      r0,|L6.16|
000008  f7fffffe          BL       Transfer_Data_Request
;;;156    }
00000c  bd10              POP      {r4,pc}
;;;157    
                          ENDP

00000e  0000              DCW      0x0000
                  |L6.16|
                          DCD      Mode_Sense6_data

                          AREA ||i.SCSI_Read10_Cmd||, CODE, READONLY, ALIGN=2

                  SCSI_Read10_Cmd PROC
;;;224    *******************************************************************************/
;;;225    void SCSI_Read10_Cmd(uint8_t lun , uint32_t LBA , uint32_t BlockNbr)
000000  b570              PUSH     {r4-r6,lr}
;;;226    {
000002  4606              MOV      r6,r0
000004  460c              MOV      r4,r1
000006  4615              MOV      r5,r2
;;;227      if (Bot_State == BOT_IDLE)
000008  4819              LDR      r0,|L7.112|
00000a  7800              LDRB     r0,[r0,#0]  ; Bot_State
00000c  bb20              CBNZ     r0,|L7.88|
;;;228      {
;;;229        if (!(SCSI_Address_Management(CBW.bLUN, SCSI_READ10, LBA, BlockNbr)))/*address out of range*/
00000e  4919              LDR      r1,|L7.116|
000010  7b48              LDRB     r0,[r1,#0xd]  ; CBW
000012  462b              MOV      r3,r5
000014  4622              MOV      r2,r4
000016  2128              MOVS     r1,#0x28
000018  f7fffffe          BL       SCSI_Address_Management
00001c  b900              CBNZ     r0,|L7.32|
                  |L7.30|
;;;230        {
;;;231          return;
;;;232        }
;;;233    
;;;234        if ((CBW.bmFlags & 0x80) != 0)
;;;235        {
;;;236          Bot_State = BOT_DATA_IN;
;;;237          Read_Memory(lun, LBA , BlockNbr);
;;;238        }
;;;239        else
;;;240        {
;;;241          Bot_Abort(BOTH_DIR);
;;;242          Set_Scsi_Sense_Data(CBW.bLUN, ILLEGAL_REQUEST, INVALID_FIELED_IN_COMMAND);
;;;243          Set_CSW (CSW_CMD_FAILED, SEND_CSW_ENABLE);
;;;244        }
;;;245        return;
;;;246      }
;;;247      else if (Bot_State == BOT_DATA_IN)
;;;248      {
;;;249        Read_Memory(lun , LBA , BlockNbr);
;;;250      }
;;;251    }
00001e  bd70              POP      {r4-r6,pc}
                  |L7.32|
000020  4814              LDR      r0,|L7.116|
000022  7b00              LDRB     r0,[r0,#0xc]          ;234  ; CBW
000024  f0000080          AND      r0,r0,#0x80           ;234
000028  b140              CBZ      r0,|L7.60|
00002a  2002              MOVS     r0,#2                 ;236
00002c  4910              LDR      r1,|L7.112|
00002e  7008              STRB     r0,[r1,#0]            ;236
000030  462a              MOV      r2,r5                 ;237
000032  4621              MOV      r1,r4                 ;237
000034  4630              MOV      r0,r6                 ;237
000036  f7fffffe          BL       Read_Memory
00003a  e00c              B        |L7.86|
                  |L7.60|
00003c  2002              MOVS     r0,#2                 ;241
00003e  f7fffffe          BL       Bot_Abort
000042  490c              LDR      r1,|L7.116|
000044  7b48              LDRB     r0,[r1,#0xd]          ;242  ; CBW
000046  2224              MOVS     r2,#0x24              ;242
000048  2105              MOVS     r1,#5                 ;242
00004a  f7fffffe          BL       Set_Scsi_Sense_Data
00004e  2101              MOVS     r1,#1                 ;243
000050  4608              MOV      r0,r1                 ;243
000052  f7fffffe          BL       Set_CSW
                  |L7.86|
000056  e7e2              B        |L7.30|
                  |L7.88|
000058  4805              LDR      r0,|L7.112|
00005a  7800              LDRB     r0,[r0,#0]            ;247  ; Bot_State
00005c  2802              CMP      r0,#2                 ;247
00005e  d104              BNE      |L7.106|
000060  462a              MOV      r2,r5                 ;249
000062  4621              MOV      r1,r4                 ;249
000064  4630              MOV      r0,r6                 ;249
000066  f7fffffe          BL       Read_Memory
                  |L7.106|
00006a  bf00              NOP      
00006c  e7d7              B        |L7.30|
;;;252    
                          ENDP

00006e  0000              DCW      0x0000
                  |L7.112|
                          DCD      Bot_State
                  |L7.116|
                          DCD      ||CBW||

                          AREA ||i.SCSI_ReadCapacity10_Cmd||, CODE, READONLY, ALIGN=2

                  SCSI_ReadCapacity10_Cmd PROC
;;;123    *******************************************************************************/
;;;124    void SCSI_ReadCapacity10_Cmd(uint8_t lun)
000000  b510              PUSH     {r4,lr}
;;;125    {
000002  4604              MOV      r4,r0
;;;126      if (MAL_GetStatus(lun))
000004  4620              MOV      r0,r4
000006  f7fffffe          BL       MAL_GetStatus
00000a  b168              CBZ      r0,|L8.40|
;;;127      {
;;;128        Set_Scsi_Sense_Data(CBW.bLUN, NOT_READY, MEDIUM_NOT_PRESENT);
00000c  491f              LDR      r1,|L8.140|
00000e  7b48              LDRB     r0,[r1,#0xd]  ; CBW
000010  223a              MOVS     r2,#0x3a
000012  2102              MOVS     r1,#2
000014  f7fffffe          BL       Set_Scsi_Sense_Data
;;;129        Set_CSW (CSW_CMD_FAILED, SEND_CSW_ENABLE);
000018  2101              MOVS     r1,#1
00001a  4608              MOV      r0,r1
00001c  f7fffffe          BL       Set_CSW
;;;130        Bot_Abort(DIR_IN);
000020  2000              MOVS     r0,#0
000022  f7fffffe          BL       Bot_Abort
                  |L8.38|
;;;131        return;
;;;132      }
;;;133    
;;;134      ReadCapacity10_Data[0] = (uint8_t)((Mass_Block_Count[lun] - 1) >> 24);
;;;135      ReadCapacity10_Data[1] = (uint8_t)((Mass_Block_Count[lun] - 1) >> 16);
;;;136      ReadCapacity10_Data[2] = (uint8_t)((Mass_Block_Count[lun] - 1) >>  8);
;;;137      ReadCapacity10_Data[3] = (uint8_t)(Mass_Block_Count[lun] - 1);
;;;138    
;;;139      ReadCapacity10_Data[4] = (uint8_t)(Mass_Block_Size[lun] >>  24);
;;;140      ReadCapacity10_Data[5] = (uint8_t)(Mass_Block_Size[lun] >>  16);
;;;141      ReadCapacity10_Data[6] = (uint8_t)(Mass_Block_Size[lun] >>  8);
;;;142      ReadCapacity10_Data[7] = (uint8_t)(Mass_Block_Size[lun]);
;;;143      Transfer_Data_Request(ReadCapacity10_Data, READ_CAPACITY10_DATA_LEN);
;;;144    }
000026  bd10              POP      {r4,pc}
                  |L8.40|
000028  4819              LDR      r0,|L8.144|
00002a  f8500024          LDR      r0,[r0,r4,LSL #2]     ;134
00002e  1e40              SUBS     r0,r0,#1              ;134
000030  0e00              LSRS     r0,r0,#24             ;134
000032  4918              LDR      r1,|L8.148|
000034  7008              STRB     r0,[r1,#0]            ;134
000036  4816              LDR      r0,|L8.144|
000038  f8500024          LDR      r0,[r0,r4,LSL #2]     ;135
00003c  1e40              SUBS     r0,r0,#1              ;135
00003e  0c00              LSRS     r0,r0,#16             ;135
000040  7048              STRB     r0,[r1,#1]            ;135
000042  4813              LDR      r0,|L8.144|
000044  f8300024          LDRH     r0,[r0,r4,LSL #2]     ;136
000048  1e40              SUBS     r0,r0,#1              ;136
00004a  0a00              LSRS     r0,r0,#8              ;136
00004c  7088              STRB     r0,[r1,#2]            ;136
00004e  4810              LDR      r0,|L8.144|
000050  f8100024          LDRB     r0,[r0,r4,LSL #2]     ;137
000054  1e40              SUBS     r0,r0,#1              ;137
000056  70c8              STRB     r0,[r1,#3]            ;137
000058  480f              LDR      r0,|L8.152|
00005a  f8500024          LDR      r0,[r0,r4,LSL #2]     ;139
00005e  0e00              LSRS     r0,r0,#24             ;139
000060  7108              STRB     r0,[r1,#4]            ;139
000062  480d              LDR      r0,|L8.152|
000064  f8500024          LDR      r0,[r0,r4,LSL #2]     ;140
000068  0c00              LSRS     r0,r0,#16             ;140
00006a  7148              STRB     r0,[r1,#5]            ;140
00006c  480a              LDR      r0,|L8.152|
00006e  f8300024          LDRH     r0,[r0,r4,LSL #2]     ;141
000072  0a00              LSRS     r0,r0,#8              ;141
000074  7188              STRB     r0,[r1,#6]            ;141
000076  4808              LDR      r0,|L8.152|
000078  f8100024          LDRB     r0,[r0,r4,LSL #2]     ;142
00007c  71c8              STRB     r0,[r1,#7]            ;142
00007e  2108              MOVS     r1,#8                 ;143
000080  4804              LDR      r0,|L8.148|
000082  f7fffffe          BL       Transfer_Data_Request
000086  bf00              NOP      
000088  e7cd              B        |L8.38|
;;;145    
                          ENDP

00008a  0000              DCW      0x0000
                  |L8.140|
                          DCD      ||CBW||
                  |L8.144|
                          DCD      Mass_Block_Count
                  |L8.148|
                          DCD      ReadCapacity10_Data
                  |L8.152|
                          DCD      Mass_Block_Size

                          AREA ||i.SCSI_ReadFormatCapacity_Cmd||, CODE, READONLY, ALIGN=2

                  SCSI_ReadFormatCapacity_Cmd PROC
;;;96     *******************************************************************************/
;;;97     void SCSI_ReadFormatCapacity_Cmd(uint8_t lun)
000000  b510              PUSH     {r4,lr}
;;;98     {
000002  4604              MOV      r4,r0
;;;99       if (MAL_GetStatus(lun) != 0 )
000004  4620              MOV      r0,r4
000006  f7fffffe          BL       MAL_GetStatus
00000a  b168              CBZ      r0,|L9.40|
;;;100      {
;;;101        Set_Scsi_Sense_Data(CBW.bLUN, NOT_READY, MEDIUM_NOT_PRESENT);
00000c  491a              LDR      r1,|L9.120|
00000e  7b48              LDRB     r0,[r1,#0xd]  ; CBW
000010  223a              MOVS     r2,#0x3a
000012  2102              MOVS     r1,#2
000014  f7fffffe          BL       Set_Scsi_Sense_Data
;;;102        Set_CSW (CSW_CMD_FAILED, SEND_CSW_ENABLE);
000018  2101              MOVS     r1,#1
00001a  4608              MOV      r0,r1
00001c  f7fffffe          BL       Set_CSW
;;;103        Bot_Abort(DIR_IN);
000020  2000              MOVS     r0,#0
000022  f7fffffe          BL       Bot_Abort
                  |L9.38|
;;;104        return;
;;;105      }
;;;106      ReadFormatCapacity_Data[4] = (uint8_t)(Mass_Block_Count[lun] >> 24);
;;;107      ReadFormatCapacity_Data[5] = (uint8_t)(Mass_Block_Count[lun] >> 16);
;;;108      ReadFormatCapacity_Data[6] = (uint8_t)(Mass_Block_Count[lun] >>  8);
;;;109      ReadFormatCapacity_Data[7] = (uint8_t)(Mass_Block_Count[lun]);
;;;110    
;;;111      ReadFormatCapacity_Data[9] = (uint8_t)(Mass_Block_Size[lun] >>  16);
;;;112      ReadFormatCapacity_Data[10] = (uint8_t)(Mass_Block_Size[lun] >>  8);
;;;113      ReadFormatCapacity_Data[11] = (uint8_t)(Mass_Block_Size[lun]);
;;;114      Transfer_Data_Request(ReadFormatCapacity_Data, READ_FORMAT_CAPACITY_DATA_LEN);
;;;115    }
000026  bd10              POP      {r4,pc}
                  |L9.40|
000028  4814              LDR      r0,|L9.124|
00002a  f8500024          LDR      r0,[r0,r4,LSL #2]     ;106
00002e  0e00              LSRS     r0,r0,#24             ;106
000030  4913              LDR      r1,|L9.128|
000032  7108              STRB     r0,[r1,#4]            ;106
000034  4811              LDR      r0,|L9.124|
000036  f8500024          LDR      r0,[r0,r4,LSL #2]     ;107
00003a  0c00              LSRS     r0,r0,#16             ;107
00003c  7148              STRB     r0,[r1,#5]            ;107
00003e  480f              LDR      r0,|L9.124|
000040  f8300024          LDRH     r0,[r0,r4,LSL #2]     ;108
000044  0a00              LSRS     r0,r0,#8              ;108
000046  7188              STRB     r0,[r1,#6]            ;108
000048  480c              LDR      r0,|L9.124|
00004a  f8100024          LDRB     r0,[r0,r4,LSL #2]     ;109
00004e  71c8              STRB     r0,[r1,#7]            ;109
000050  480c              LDR      r0,|L9.132|
000052  f8500024          LDR      r0,[r0,r4,LSL #2]     ;111
000056  0c00              LSRS     r0,r0,#16             ;111
000058  7248              STRB     r0,[r1,#9]            ;111
00005a  480a              LDR      r0,|L9.132|
00005c  f8300024          LDRH     r0,[r0,r4,LSL #2]     ;112
000060  0a00              LSRS     r0,r0,#8              ;112
000062  7288              STRB     r0,[r1,#0xa]          ;112
000064  4807              LDR      r0,|L9.132|
000066  f8100024          LDRB     r0,[r0,r4,LSL #2]     ;113
00006a  72c8              STRB     r0,[r1,#0xb]          ;113
00006c  210c              MOVS     r1,#0xc               ;114
00006e  4804              LDR      r0,|L9.128|
000070  f7fffffe          BL       Transfer_Data_Request
000074  bf00              NOP      
000076  e7d6              B        |L9.38|
;;;116    
                          ENDP

                  |L9.120|
                          DCD      ||CBW||
                  |L9.124|
                          DCD      Mass_Block_Count
                  |L9.128|
                          DCD      ReadFormatCapacity_Data
                  |L9.132|
                          DCD      Mass_Block_Size

                          AREA ||i.SCSI_RequestSense_Cmd||, CODE, READONLY, ALIGN=2

                  SCSI_RequestSense_Cmd PROC
;;;176    *******************************************************************************/
;;;177    void SCSI_RequestSense_Cmd (uint8_t lun)
000000  b570              PUSH     {r4-r6,lr}
;;;178    {
000002  4605              MOV      r5,r0
;;;179      uint8_t Request_Sense_data_Length;
;;;180    
;;;181      if (CBW.CB[4] <= REQUEST_SENSE_DATA_LEN)
000004  4806              LDR      r0,|L10.32|
000006  7cc0              LDRB     r0,[r0,#0x13]
000008  2812              CMP      r0,#0x12
00000a  dc02              BGT      |L10.18|
;;;182      {
;;;183        Request_Sense_data_Length = CBW.CB[4];
00000c  4804              LDR      r0,|L10.32|
00000e  7cc4              LDRB     r4,[r0,#0x13]
000010  e000              B        |L10.20|
                  |L10.18|
;;;184      }
;;;185      else
;;;186      {
;;;187        Request_Sense_data_Length = REQUEST_SENSE_DATA_LEN;
000012  2412              MOVS     r4,#0x12
                  |L10.20|
;;;188      }
;;;189      Transfer_Data_Request(Scsi_Sense_Data, Request_Sense_data_Length);
000014  4621              MOV      r1,r4
000016  4803              LDR      r0,|L10.36|
000018  f7fffffe          BL       Transfer_Data_Request
;;;190    }
00001c  bd70              POP      {r4-r6,pc}
;;;191    
                          ENDP

00001e  0000              DCW      0x0000
                  |L10.32|
                          DCD      ||CBW||
                  |L10.36|
                          DCD      Scsi_Sense_Data

                          AREA ||i.SCSI_Start_Stop_Unit_Cmd||, CODE, READONLY, ALIGN=1

                  SCSI_Start_Stop_Unit_Cmd PROC
;;;212    *******************************************************************************/
;;;213    void SCSI_Start_Stop_Unit_Cmd(uint8_t lun)
000000  b510              PUSH     {r4,lr}
;;;214    {
000002  4604              MOV      r4,r0
;;;215      Set_CSW (CSW_CMD_PASSED, SEND_CSW_ENABLE);
000004  2101              MOVS     r1,#1
000006  2000              MOVS     r0,#0
000008  f7fffffe          BL       Set_CSW
;;;216    }
00000c  bd10              POP      {r4,pc}
;;;217    
                          ENDP


                          AREA ||i.SCSI_TestUnitReady_Cmd||, CODE, READONLY, ALIGN=2

                  SCSI_TestUnitReady_Cmd PROC
;;;335    *******************************************************************************/
;;;336    void SCSI_TestUnitReady_Cmd(uint8_t lun)
000000  b510              PUSH     {r4,lr}
;;;337    {
000002  4604              MOV      r4,r0
;;;338      if (MAL_GetStatus(lun))
000004  4620              MOV      r0,r4
000006  f7fffffe          BL       MAL_GetStatus
00000a  b168              CBZ      r0,|L12.40|
;;;339      {
;;;340        Set_Scsi_Sense_Data(CBW.bLUN, NOT_READY, MEDIUM_NOT_PRESENT);
00000c  4909              LDR      r1,|L12.52|
00000e  7b48              LDRB     r0,[r1,#0xd]  ; CBW
000010  223a              MOVS     r2,#0x3a
000012  2102              MOVS     r1,#2
000014  f7fffffe          BL       Set_Scsi_Sense_Data
;;;341        Set_CSW (CSW_CMD_FAILED, SEND_CSW_ENABLE);
000018  2101              MOVS     r1,#1
00001a  4608              MOV      r0,r1
00001c  f7fffffe          BL       Set_CSW
;;;342        Bot_Abort(DIR_IN);
000020  2000              MOVS     r0,#0
000022  f7fffffe          BL       Bot_Abort
                  |L12.38|
;;;343        return;
;;;344      }
;;;345      else
;;;346      {
;;;347        Set_CSW (CSW_CMD_PASSED, SEND_CSW_ENABLE);
;;;348      }
;;;349    }
000026  bd10              POP      {r4,pc}
                  |L12.40|
000028  2101              MOVS     r1,#1                 ;347
00002a  2000              MOVS     r0,#0                 ;347
00002c  f7fffffe          BL       Set_CSW
000030  bf00              NOP      
000032  e7f8              B        |L12.38|
;;;350    /*******************************************************************************
                          ENDP

                  |L12.52|
                          DCD      ||CBW||

                          AREA ||i.SCSI_Valid_Cmd||, CODE, READONLY, ALIGN=2

                  SCSI_Valid_Cmd PROC
;;;317    *******************************************************************************/
;;;318    void SCSI_Valid_Cmd(uint8_t lun)
000000  b510              PUSH     {r4,lr}
;;;319    {
000002  4604              MOV      r4,r0
;;;320      if (CBW.dDataLength != 0)
000004  480a              LDR      r0,|L13.48|
000006  6880              LDR      r0,[r0,#8]  ; CBW
000008  b168              CBZ      r0,|L13.38|
;;;321      {
;;;322        Bot_Abort(BOTH_DIR);
00000a  2002              MOVS     r0,#2
00000c  f7fffffe          BL       Bot_Abort
;;;323        Set_Scsi_Sense_Data(CBW.bLUN, ILLEGAL_REQUEST, INVALID_COMMAND);
000010  4907              LDR      r1,|L13.48|
000012  7b48              LDRB     r0,[r1,#0xd]  ; CBW
000014  2220              MOVS     r2,#0x20
000016  2105              MOVS     r1,#5
000018  f7fffffe          BL       Set_Scsi_Sense_Data
;;;324        Set_CSW (CSW_CMD_FAILED, SEND_CSW_DISABLE);
00001c  2100              MOVS     r1,#0
00001e  2001              MOVS     r0,#1
000020  f7fffffe          BL       Set_CSW
000024  e003              B        |L13.46|
                  |L13.38|
;;;325      }
;;;326      else
;;;327        Set_CSW (CSW_CMD_PASSED, SEND_CSW_ENABLE);
000026  2101              MOVS     r1,#1
000028  2000              MOVS     r0,#0
00002a  f7fffffe          BL       Set_CSW
                  |L13.46|
;;;328    }
00002e  bd10              POP      {r4,pc}
;;;329    /*******************************************************************************
                          ENDP

                  |L13.48|
                          DCD      ||CBW||

                          AREA ||i.SCSI_Vender_Cmd||, CODE, READONLY, ALIGN=2

                  SCSI_Vender_Cmd PROC
;;;399    
;;;400    void SCSI_Vender_Cmd(uint8_t lun)
000000  b570              PUSH     {r4-r6,lr}
;;;401    {
000002  4606              MOV      r6,r0
;;;402    	unsigned short usInDatalen;
;;;403    	unsigned short usSendlen;
;;;404    	
;;;405    	if (Bot_State == BOT_IDLE)
000004  48a3              LDR      r0,|L14.660|
000006  7800              LDRB     r0,[r0,#0]  ; Bot_State
000008  2800              CMP      r0,#0
00000a  d17b              BNE      |L14.260|
;;;406    	{
;;;407    		if ((CBW.bmFlags & 0x80) == 0)
00000c  48a2              LDR      r0,|L14.664|
00000e  7b00              LDRB     r0,[r0,#0xc]  ; CBW
000010  f0000080          AND      r0,r0,#0x80
000014  b978              CBNZ     r0,|L14.54|
;;;408    		{
;;;409    			Bot_State = BOT_DATA_OUT;
000016  2001              MOVS     r0,#1
000018  499e              LDR      r1,|L14.660|
00001a  7008              STRB     r0,[r1,#0]
;;;410    			g_PackageID = 0;
00001c  2000              MOVS     r0,#0
00001e  499f              LDR      r1,|L14.668|
000020  7008              STRB     r0,[r1,#0]
;;;411    			g_UMSLen = 0;
000022  499f              LDR      r1,|L14.672|
000024  6008              STR      r0,[r1,#0]  ; g_UMSLen
;;;412    			g_UMSOffset =0;
000026  499f              LDR      r1,|L14.676|
000028  8008              STRH     r0,[r1,#0]
;;;413    			
;;;414    			SetEPRxStatus(ENDP2, EP_RX_VALID);
00002a  f44f5140          MOV      r1,#0x3000
00002e  2002              MOVS     r0,#2
000030  f7fffffe          BL       SetEPRxStatus
000034  e064              B        |L14.256|
                  |L14.54|
;;;415    		}
;;;416    		else
;;;417    		{
;;;418    			//·µ»ØÊý¾Ý
;;;419    			if (TransferState == TXFR_IDLE )
000036  489c              LDR      r0,|L14.680|
000038  7800              LDRB     r0,[r0,#0]  ; TransferState
00003a  bb60              CBNZ     r0,|L14.150|
;;;420    			  {
;;;421    				Bulk_Data_Buff[0] = (G_APDU.RLE +2);
00003c  489b              LDR      r0,|L14.684|
00003e  7a00              LDRB     r0,[r0,#8]  ; G_APDU
000040  1c80              ADDS     r0,r0,#2
000042  499b              LDR      r1,|L14.688|
000044  7008              STRB     r0,[r1,#0]
;;;422    				Bulk_Data_Buff[1] = (G_APDU.RLE +2)>>8;
000046  4899              LDR      r0,|L14.684|
000048  8900              LDRH     r0,[r0,#8]  ; G_APDU
00004a  1c80              ADDS     r0,r0,#2
00004c  0a00              LSRS     r0,r0,#8
00004e  7048              STRB     r0,[r1,#1]
;;;423    
;;;424    
;;;425    				if(G_APDU.RLE)
000050  4896              LDR      r0,|L14.684|
000052  6880              LDR      r0,[r0,#8]  ; G_APDU
000054  b130              CBZ      r0,|L14.100|
;;;426    					memcpy(Bulk_Data_Buff+2, G_APDU.pOutData, G_APDU.RLE);
000056  4895              LDR      r0,|L14.684|
000058  6882              LDR      r2,[r0,#8]  ; G_APDU
00005a  6941              LDR      r1,[r0,#0x14]  ; G_APDU
00005c  4894              LDR      r0,|L14.688|
00005e  1c80              ADDS     r0,r0,#2
000060  f7fffffe          BL       __aeabi_memcpy
                  |L14.100|
;;;427    
;;;428    				Bulk_Data_Buff[G_APDU.RLE+2] = G_APDU.SW1;
000064  4891              LDR      r0,|L14.684|
000066  7b01              LDRB     r1,[r0,#0xc]  ; G_APDU
000068  6880              LDR      r0,[r0,#8]  ; G_APDU
00006a  1c80              ADDS     r0,r0,#2
00006c  4a90              LDR      r2,|L14.688|
00006e  5411              STRB     r1,[r2,r0]
;;;429    				Bulk_Data_Buff[G_APDU.RLE+3] = G_APDU.SW2;
000070  488e              LDR      r0,|L14.684|
000072  7b41              LDRB     r1,[r0,#0xd]  ; G_APDU
000074  6880              LDR      r0,[r0,#8]  ; G_APDU
000076  1cc0              ADDS     r0,r0,#3
000078  5411              STRB     r1,[r2,r0]
;;;430    
;;;431    				g_Sendlen = G_APDU.RLE+4;
00007a  488c              LDR      r0,|L14.684|
00007c  8900              LDRH     r0,[r0,#8]  ; G_APDU
00007e  1d00              ADDS     r0,r0,#4
000080  498c              LDR      r1,|L14.692|
000082  8008              STRH     r0,[r1,#0]
;;;432    				g_UMSOffset =0;
000084  2000              MOVS     r0,#0
000086  4987              LDR      r1,|L14.676|
000088  8008              STRH     r0,[r1,#0]
;;;433    
;;;434    				Bot_State = BOT_DATA_IN;
00008a  2002              MOVS     r0,#2
00008c  4981              LDR      r1,|L14.660|
00008e  7008              STRB     r0,[r1,#0]
;;;435    				TransferState = TXFR_ONGOING;
000090  2001              MOVS     r0,#1
000092  4985              LDR      r1,|L14.680|
000094  7008              STRB     r0,[r1,#0]
                  |L14.150|
;;;436    			  }
;;;437    
;;;438    			if (TransferState == TXFR_ONGOING )
000096  4884              LDR      r0,|L14.680|
000098  7800              LDRB     r0,[r0,#0]  ; TransferState
00009a  2801              CMP      r0,#1
00009c  d124              BNE      |L14.232|
;;;439    			  {
;;;440    			  	 usSendlen = (g_Sendlen > BULK_MAX_PACKET_SIZE)?BULK_MAX_PACKET_SIZE:g_Sendlen;
00009e  4885              LDR      r0,|L14.692|
0000a0  8800              LDRH     r0,[r0,#0]  ; g_Sendlen
0000a2  2840              CMP      r0,#0x40
0000a4  dd01              BLE      |L14.170|
0000a6  2040              MOVS     r0,#0x40
0000a8  e001              B        |L14.174|
                  |L14.170|
0000aa  4882              LDR      r0,|L14.692|
0000ac  8800              LDRH     r0,[r0,#0]  ; g_Sendlen
                  |L14.174|
0000ae  4604              MOV      r4,r0
;;;441    				 USB_SIL_Write(EP1_IN, Bulk_Data_Buff , usSendlen);
0000b0  4622              MOV      r2,r4
0000b2  497f              LDR      r1,|L14.688|
0000b4  2081              MOVS     r0,#0x81
0000b6  f7fffffe          BL       USB_SIL_Write
;;;442    
;;;443    			    	SetEPTxCount(ENDP1, usSendlen);
0000ba  4621              MOV      r1,r4
0000bc  2001              MOVS     r0,#1
0000be  f7fffffe          BL       SetEPTxCount
;;;444    			    	SetEPTxStatus(ENDP1, EP_TX_VALID);  
0000c2  2130              MOVS     r1,#0x30
0000c4  2001              MOVS     r0,#1
0000c6  f7fffffe          BL       SetEPTxStatus
;;;445    			    	g_UMSOffset += usSendlen;
0000ca  4876              LDR      r0,|L14.676|
0000cc  8800              LDRH     r0,[r0,#0]  ; g_UMSOffset
0000ce  4420              ADD      r0,r0,r4
0000d0  4974              LDR      r1,|L14.676|
0000d2  8008              STRH     r0,[r1,#0]
;;;446    			       g_Sendlen -= usSendlen;
0000d4  4877              LDR      r0,|L14.692|
0000d6  8800              LDRH     r0,[r0,#0]  ; g_Sendlen
0000d8  1b00              SUBS     r0,r0,r4
0000da  4976              LDR      r1,|L14.692|
0000dc  8008              STRH     r0,[r1,#0]
;;;447    
;;;448    			       CSW.dDataResidue -= usSendlen;	    
0000de  4876              LDR      r0,|L14.696|
0000e0  6880              LDR      r0,[r0,#8]  ; CSW
0000e2  1b00              SUBS     r0,r0,r4
0000e4  4974              LDR      r1,|L14.696|
0000e6  6088              STR      r0,[r1,#8]  ; CSW
                  |L14.232|
;;;449    			  }
;;;450    
;;;451    			
;;;452    			  if (g_Sendlen == 0)
0000e8  4872              LDR      r0,|L14.692|
0000ea  8800              LDRH     r0,[r0,#0]  ; g_Sendlen
0000ec  b940              CBNZ     r0,|L14.256|
;;;453    			  {
;;;454    			     g_UMSOffset = 0;
0000ee  2000              MOVS     r0,#0
0000f0  496c              LDR      r1,|L14.676|
0000f2  8008              STRH     r0,[r1,#0]
;;;455    			     Bot_State = BOT_DATA_IN_LAST;
0000f4  2003              MOVS     r0,#3
0000f6  4967              LDR      r1,|L14.660|
0000f8  7008              STRB     r0,[r1,#0]
;;;456    			    TransferState = TXFR_IDLE;
0000fa  2000              MOVS     r0,#0
0000fc  496a              LDR      r1,|L14.680|
0000fe  7008              STRB     r0,[r1,#0]
                  |L14.256|
;;;457    
;;;458    			  }
;;;459    			
;;;460    		}
;;;461    		return;
;;;462    	}
;;;463    	else if (Bot_State == BOT_DATA_OUT)
;;;464    	{
;;;465    		if(g_PackageID == 0)
;;;466    		{
;;;467    			G_APDU.CLA = Bulk_Data_Buff[0];
;;;468    			G_APDU.INS = Bulk_Data_Buff[1];
;;;469    			G_APDU.PP1 = Bulk_Data_Buff[2];
;;;470    			G_APDU.PP2 = Bulk_Data_Buff[3];
;;;471    			G_APDU.PP3 = Bulk_Data_Buff[4];
;;;472    			G_APDU.PP4 = Bulk_Data_Buff[5];
;;;473    			G_APDU.PP5 = Bulk_Data_Buff[6];
;;;474    
;;;475    			switch(G_APDU.INS)
;;;476    			{
;;;477    			case CMD_BOOT_VERSION:
;;;478    			case CMD_SPIFLASH_GETID:
;;;479    			case CMD_SPIFLASH_READ:
;;;480    #if BOOT_TEST
;;;481    			case 0xEF:
;;;482    #endif
;;;483    				usInDatalen = 0;
;;;484    				break;
;;;485    			default:
;;;486    				usInDatalen = G_APDU.PP4*256 + G_APDU.PP5;
;;;487    				break;
;;;488    			}
;;;489    
;;;490    
;;;491    			if(usInDatalen>(64-7))
;;;492    			{
;;;493    				g_UMSLen = usInDatalen+7 -64;
;;;494    				memcpy(G_APDU.pInData, Bulk_Data_Buff+7, 64-7);
;;;495    				g_UMSOffset = 64-7;
;;;496    				g_PackageID++;
;;;497    				SetEPRxStatus(ENDP2, EP_RX_VALID);
;;;498    
;;;499    			}
;;;500    			else
;;;501    			{
;;;502    				g_UMSLen = 0;
;;;503    				memcpy(G_APDU.pInData, Bulk_Data_Buff+7, usInDatalen);
;;;504    
;;;505    				Boot_Command();
;;;506    				Set_CSW (CSW_CMD_PASSED, SEND_CSW_ENABLE);
;;;507    			}
;;;508    			
;;;509    			
;;;510    		}
;;;511    		else
;;;512    		{
;;;513    		
;;;514    			if(g_UMSLen>64)
;;;515    			{
;;;516    				memcpy(G_APDU.pInData+g_UMSOffset, Bulk_Data_Buff, 64);
;;;517    				g_UMSOffset += 64;
;;;518    				g_UMSLen -= 64;
;;;519    				SetEPRxStatus(ENDP2, EP_RX_VALID);
;;;520    			}
;;;521    			else
;;;522    			{
;;;523    				memcpy(G_APDU.pInData+g_UMSOffset, Bulk_Data_Buff, g_UMSLen);
;;;524    				
;;;525    				Boot_Command();
;;;526    				Set_CSW (CSW_CMD_PASSED, SEND_CSW_ENABLE);
;;;527    			}
;;;528    
;;;529    		}		
;;;530    		
;;;531    	}
;;;532    	else if (Bot_State == BOT_DATA_IN)
;;;533    	{
;;;534    			  if (TransferState == TXFR_ONGOING )
;;;535    			  {
;;;536    			  	 usSendlen = (g_Sendlen > BULK_MAX_PACKET_SIZE)?BULK_MAX_PACKET_SIZE:g_Sendlen;
;;;537    				 USB_SIL_Write(EP1_IN, Bulk_Data_Buff+g_UMSOffset , usSendlen);
;;;538    
;;;539    			    	SetEPTxCount(ENDP1, usSendlen);
;;;540    			    	SetEPTxStatus(ENDP1, EP_TX_VALID);  
;;;541    			    	g_UMSOffset += usSendlen;
;;;542    			       g_Sendlen -= usSendlen;
;;;543    			  }
;;;544    
;;;545    			
;;;546    			  if (g_Sendlen == 0)
;;;547    			  {
;;;548    			    g_UMSOffset = 0;
;;;549    			    Bot_State = BOT_DATA_IN_LAST;
;;;550    			    TransferState = TXFR_IDLE;
;;;551    					CSW.dDataResidue = 0;
;;;552    
;;;553    			  }
;;;554    
;;;555    	}
;;;556    }
000100  bd70              POP      {r4-r6,pc}
000102  e7ff              B        |L14.260|
                  |L14.260|
000104  4863              LDR      r0,|L14.660|
000106  7800              LDRB     r0,[r0,#0]            ;463  ; Bot_State
000108  2801              CMP      r0,#1                 ;463
00010a  d176              BNE      |L14.506|
00010c  4863              LDR      r0,|L14.668|
00010e  7800              LDRB     r0,[r0,#0]            ;465  ; g_PackageID
000110  2800              CMP      r0,#0                 ;465
000112  d155              BNE      |L14.448|
000114  4866              LDR      r0,|L14.688|
000116  7800              LDRB     r0,[r0,#0]            ;467  ; Bulk_Data_Buff
000118  4964              LDR      r1,|L14.684|
00011a  7008              STRB     r0,[r1,#0]            ;467
00011c  4864              LDR      r0,|L14.688|
00011e  7840              LDRB     r0,[r0,#1]            ;468  ; Bulk_Data_Buff
000120  7048              STRB     r0,[r1,#1]            ;468
000122  4863              LDR      r0,|L14.688|
000124  7880              LDRB     r0,[r0,#2]            ;469  ; Bulk_Data_Buff
000126  7088              STRB     r0,[r1,#2]            ;469
000128  4861              LDR      r0,|L14.688|
00012a  78c0              LDRB     r0,[r0,#3]            ;470  ; Bulk_Data_Buff
00012c  70c8              STRB     r0,[r1,#3]            ;470
00012e  4860              LDR      r0,|L14.688|
000130  7900              LDRB     r0,[r0,#4]            ;471  ; Bulk_Data_Buff
000132  7108              STRB     r0,[r1,#4]            ;471
000134  485e              LDR      r0,|L14.688|
000136  7940              LDRB     r0,[r0,#5]            ;472  ; Bulk_Data_Buff
000138  7148              STRB     r0,[r1,#5]            ;472
00013a  485d              LDR      r0,|L14.688|
00013c  7980              LDRB     r0,[r0,#6]            ;473  ; Bulk_Data_Buff
00013e  7188              STRB     r0,[r1,#6]            ;473
000140  4608              MOV      r0,r1                 ;475
000142  7840              LDRB     r0,[r0,#1]            ;475  ; G_APDU
000144  b120              CBZ      r0,|L14.336|
000146  2804              CMP      r0,#4                 ;475
000148  d003              BEQ      |L14.338|
00014a  2805              CMP      r0,#5                 ;475
00014c  d104              BNE      |L14.344|
00014e  e001              B        |L14.340|
                  |L14.336|
000150  bf00              NOP                            ;478
                  |L14.338|
000152  bf00              NOP                            ;479
                  |L14.340|
000154  2500              MOVS     r5,#0                 ;483
000156  e006              B        |L14.358|
                  |L14.344|
000158  4854              LDR      r0,|L14.684|
00015a  7981              LDRB     r1,[r0,#6]            ;486  ; G_APDU
00015c  7940              LDRB     r0,[r0,#5]            ;486  ; G_APDU
00015e  eb012000          ADD      r0,r1,r0,LSL #8       ;486
000162  b285              UXTH     r5,r0                 ;486
000164  bf00              NOP                            ;487
                  |L14.358|
000166  bf00              NOP                            ;484
000168  2d39              CMP      r5,#0x39              ;491
00016a  dd18              BLE      |L14.414|
00016c  f1a50039          SUB      r0,r5,#0x39           ;493
000170  494b              LDR      r1,|L14.672|
000172  6008              STR      r0,[r1,#0]            ;493  ; g_UMSLen
000174  494d              LDR      r1,|L14.684|
000176  2239              MOVS     r2,#0x39              ;494
000178  6908              LDR      r0,[r1,#0x10]         ;494  ; G_APDU
00017a  494d              LDR      r1,|L14.688|
00017c  1dc9              ADDS     r1,r1,#7              ;494
00017e  f7fffffe          BL       __aeabi_memcpy
000182  2039              MOVS     r0,#0x39              ;495
000184  4947              LDR      r1,|L14.676|
000186  8008              STRH     r0,[r1,#0]            ;495
000188  4844              LDR      r0,|L14.668|
00018a  7800              LDRB     r0,[r0,#0]            ;496  ; g_PackageID
00018c  1c40              ADDS     r0,r0,#1              ;496
00018e  4943              LDR      r1,|L14.668|
000190  7008              STRB     r0,[r1,#0]            ;496
000192  f44f5140          MOV      r1,#0x3000            ;497
000196  2002              MOVS     r0,#2                 ;497
000198  f7fffffe          BL       SetEPRxStatus
00019c  e078              B        |L14.656|
                  |L14.414|
00019e  2000              MOVS     r0,#0                 ;502
0001a0  493f              LDR      r1,|L14.672|
0001a2  6008              STR      r0,[r1,#0]            ;502  ; g_UMSLen
0001a4  4941              LDR      r1,|L14.684|
0001a6  462a              MOV      r2,r5                 ;503
0001a8  6908              LDR      r0,[r1,#0x10]         ;503  ; G_APDU
0001aa  4941              LDR      r1,|L14.688|
0001ac  1dc9              ADDS     r1,r1,#7              ;503
0001ae  f7fffffe          BL       __aeabi_memcpy
0001b2  f7fffffe          BL       Boot_Command
0001b6  2101              MOVS     r1,#1                 ;506
0001b8  2000              MOVS     r0,#0                 ;506
0001ba  f7fffffe          BL       Set_CSW
0001be  e067              B        |L14.656|
                  |L14.448|
0001c0  4837              LDR      r0,|L14.672|
0001c2  6800              LDR      r0,[r0,#0]            ;514  ; g_UMSLen
0001c4  2840              CMP      r0,#0x40              ;514
0001c6  d919              BLS      |L14.508|
0001c8  4938              LDR      r1,|L14.684|
0001ca  6909              LDR      r1,[r1,#0x10]         ;516  ; G_APDU
0001cc  4a35              LDR      r2,|L14.676|
0001ce  8812              LDRH     r2,[r2,#0]            ;516  ; g_UMSOffset
0001d0  1888              ADDS     r0,r1,r2              ;516
0001d2  2240              MOVS     r2,#0x40              ;516
0001d4  4936              LDR      r1,|L14.688|
0001d6  f7fffffe          BL       __aeabi_memcpy
0001da  4832              LDR      r0,|L14.676|
0001dc  8800              LDRH     r0,[r0,#0]            ;517  ; g_UMSOffset
0001de  3040              ADDS     r0,r0,#0x40           ;517
0001e0  4930              LDR      r1,|L14.676|
0001e2  8008              STRH     r0,[r1,#0]            ;517
0001e4  482e              LDR      r0,|L14.672|
0001e6  6800              LDR      r0,[r0,#0]            ;518  ; g_UMSLen
0001e8  3840              SUBS     r0,r0,#0x40           ;518
0001ea  492d              LDR      r1,|L14.672|
0001ec  6008              STR      r0,[r1,#0]            ;518  ; g_UMSLen
0001ee  f44f5140          MOV      r1,#0x3000            ;519
0001f2  2002              MOVS     r0,#2                 ;519
0001f4  f7fffffe          BL       SetEPRxStatus
0001f8  e04a              B        |L14.656|
                  |L14.506|
0001fa  e010              B        |L14.542|
                  |L14.508|
0001fc  492b              LDR      r1,|L14.684|
0001fe  6909              LDR      r1,[r1,#0x10]         ;523  ; G_APDU
000200  4a28              LDR      r2,|L14.676|
000202  8812              LDRH     r2,[r2,#0]            ;523  ; g_UMSOffset
000204  1888              ADDS     r0,r1,r2              ;523
000206  4926              LDR      r1,|L14.672|
000208  680a              LDR      r2,[r1,#0]            ;523  ; g_UMSLen
00020a  4929              LDR      r1,|L14.688|
00020c  f7fffffe          BL       __aeabi_memcpy
000210  f7fffffe          BL       Boot_Command
000214  2101              MOVS     r1,#1                 ;526
000216  2000              MOVS     r0,#0                 ;526
000218  f7fffffe          BL       Set_CSW
00021c  e038              B        |L14.656|
                  |L14.542|
00021e  481d              LDR      r0,|L14.660|
000220  7800              LDRB     r0,[r0,#0]            ;532  ; Bot_State
000222  2802              CMP      r0,#2                 ;532
000224  d134              BNE      |L14.656|
000226  4820              LDR      r0,|L14.680|
000228  7800              LDRB     r0,[r0,#0]            ;534  ; TransferState
00022a  2801              CMP      r0,#1                 ;534
00022c  d122              BNE      |L14.628|
00022e  4821              LDR      r0,|L14.692|
000230  8800              LDRH     r0,[r0,#0]            ;536  ; g_Sendlen
000232  2840              CMP      r0,#0x40              ;536
000234  dd01              BLE      |L14.570|
000236  2040              MOVS     r0,#0x40              ;536
000238  e001              B        |L14.574|
                  |L14.570|
00023a  481e              LDR      r0,|L14.692|
00023c  8800              LDRH     r0,[r0,#0]            ;536  ; g_Sendlen
                  |L14.574|
00023e  4604              MOV      r4,r0                 ;536
000240  481b              LDR      r0,|L14.688|
000242  4a18              LDR      r2,|L14.676|
000244  8812              LDRH     r2,[r2,#0]            ;537  ; g_UMSOffset
000246  1881              ADDS     r1,r0,r2              ;537
000248  4622              MOV      r2,r4                 ;537
00024a  2081              MOVS     r0,#0x81              ;537
00024c  f7fffffe          BL       USB_SIL_Write
000250  4621              MOV      r1,r4                 ;539
000252  2001              MOVS     r0,#1                 ;539
000254  f7fffffe          BL       SetEPTxCount
000258  2130              MOVS     r1,#0x30              ;540
00025a  2001              MOVS     r0,#1                 ;540
00025c  f7fffffe          BL       SetEPTxStatus
000260  4810              LDR      r0,|L14.676|
000262  8800              LDRH     r0,[r0,#0]            ;541  ; g_UMSOffset
000264  4420              ADD      r0,r0,r4              ;541
000266  490f              LDR      r1,|L14.676|
000268  8008              STRH     r0,[r1,#0]            ;541
00026a  4812              LDR      r0,|L14.692|
00026c  8800              LDRH     r0,[r0,#0]            ;542  ; g_Sendlen
00026e  1b00              SUBS     r0,r0,r4              ;542
000270  4910              LDR      r1,|L14.692|
000272  8008              STRH     r0,[r1,#0]            ;542
                  |L14.628|
000274  480f              LDR      r0,|L14.692|
000276  8800              LDRH     r0,[r0,#0]            ;546  ; g_Sendlen
000278  b950              CBNZ     r0,|L14.656|
00027a  2000              MOVS     r0,#0                 ;548
00027c  4909              LDR      r1,|L14.676|
00027e  8008              STRH     r0,[r1,#0]            ;548
000280  2003              MOVS     r0,#3                 ;549
000282  4904              LDR      r1,|L14.660|
000284  7008              STRB     r0,[r1,#0]            ;549
000286  2000              MOVS     r0,#0                 ;550
000288  4907              LDR      r1,|L14.680|
00028a  7008              STRB     r0,[r1,#0]            ;550
00028c  490a              LDR      r1,|L14.696|
00028e  6088              STR      r0,[r1,#8]            ;551  ; CSW
                  |L14.656|
000290  bf00              NOP      
000292  e735              B        |L14.256|
;;;557    
                          ENDP

                  |L14.660|
                          DCD      Bot_State
                  |L14.664|
                          DCD      ||CBW||
                  |L14.668|
                          DCD      g_PackageID
                  |L14.672|
                          DCD      g_UMSLen
                  |L14.676|
                          DCD      g_UMSOffset
                  |L14.680|
                          DCD      TransferState
                  |L14.684|
                          DCD      G_APDU
                  |L14.688|
                          DCD      Bulk_Data_Buff
                  |L14.692|
                          DCD      g_Sendlen
                  |L14.696|
                          DCD      ||CSW||

                          AREA ||i.SCSI_Verify10_Cmd||, CODE, READONLY, ALIGN=2

                  SCSI_Verify10_Cmd PROC
;;;297    *******************************************************************************/
;;;298    void SCSI_Verify10_Cmd(uint8_t lun)
000000  b510              PUSH     {r4,lr}
;;;299    {
000002  4604              MOV      r4,r0
;;;300      if ((CBW.dDataLength == 0) && !(CBW.CB[1] & BLKVFY))/* BLKVFY not set*/
000004  480d              LDR      r0,|L15.60|
000006  6880              LDR      r0,[r0,#8]  ; CBW
000008  b948              CBNZ     r0,|L15.30|
00000a  480c              LDR      r0,|L15.60|
00000c  7c00              LDRB     r0,[r0,#0x10]
00000e  f0000004          AND      r0,r0,#4
000012  b920              CBNZ     r0,|L15.30|
;;;301      {
;;;302        Set_CSW (CSW_CMD_PASSED, SEND_CSW_ENABLE);
000014  2101              MOVS     r1,#1
000016  2000              MOVS     r0,#0
000018  f7fffffe          BL       Set_CSW
00001c  e00c              B        |L15.56|
                  |L15.30|
;;;303      }
;;;304      else
;;;305      {
;;;306        Bot_Abort(BOTH_DIR);
00001e  2002              MOVS     r0,#2
000020  f7fffffe          BL       Bot_Abort
;;;307        Set_Scsi_Sense_Data(CBW.bLUN, ILLEGAL_REQUEST, INVALID_FIELED_IN_COMMAND);
000024  4905              LDR      r1,|L15.60|
000026  7b48              LDRB     r0,[r1,#0xd]  ; CBW
000028  2224              MOVS     r2,#0x24
00002a  2105              MOVS     r1,#5
00002c  f7fffffe          BL       Set_Scsi_Sense_Data
;;;308        Set_CSW (CSW_CMD_FAILED, SEND_CSW_DISABLE);
000030  2100              MOVS     r1,#0
000032  2001              MOVS     r0,#1
000034  f7fffffe          BL       Set_CSW
                  |L15.56|
;;;309      }
;;;310    }
000038  bd10              POP      {r4,pc}
;;;311    /*******************************************************************************
                          ENDP

00003a  0000              DCW      0x0000
                  |L15.60|
                          DCD      ||CBW||

                          AREA ||i.Set_Scsi_Sense_Data||, CODE, READONLY, ALIGN=2

                  Set_Scsi_Sense_Data PROC
;;;199    *******************************************************************************/
;;;200    void Set_Scsi_Sense_Data(uint8_t lun, uint8_t Sens_Key, uint8_t Asc)
000000  4b01              LDR      r3,|L16.8|
;;;201    {
;;;202      Scsi_Sense_Data[2] = Sens_Key;
000002  7099              STRB     r1,[r3,#2]
;;;203      Scsi_Sense_Data[12] = Asc;
000004  731a              STRB     r2,[r3,#0xc]
;;;204    }
000006  4770              BX       lr
;;;205    
                          ENDP

                  |L16.8|
                          DCD      Scsi_Sense_Data

                          AREA ||.data||, DATA, ALIGN=2

                  g_PackageID
000000  00000000          DCB      0x00,0x00,0x00,0x00
                  g_UMSLen
                          DCD      0x00000000
                  g_UMSOffset
000008  0000              DCB      0x00,0x00
                  g_Sendlen
00000a  0000              DCB      0x00,0x00

;*** Start embedded assembler ***

#line 1 "..\\src\\usb_scsi.c"
	AREA ||.rev16_text||, CODE
	THUMB
	EXPORT |__asm___10_usb_scsi_c_4f4a76f0____REV16|
#line 129 "C:\\Keil_v5\\ARM\\PACK\\ARM\\CMSIS\\3.20.4\\CMSIS\\Include\\core_cmInstr.h"
|__asm___10_usb_scsi_c_4f4a76f0____REV16| PROC
#line 130

 rev16 r0, r0
 bx lr
	ENDP
	AREA ||.revsh_text||, CODE
	THUMB
	EXPORT |__asm___10_usb_scsi_c_4f4a76f0____REVSH|
#line 144
|__asm___10_usb_scsi_c_4f4a76f0____REVSH| PROC
#line 145

 revsh r0, r0
 bx lr
	ENDP

;*** End   embedded assembler ***
